<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>日程選択</title>
<style>
	header {
		margin: 0 0 10px 0;
		padding: 20px;
		background-color: yellow;
		color: black;
	}
	
	h1 {
		margin: 0px;
	}
	
    table {
        border-collapse: collapse;
        width: 300px;
        background-color: #00bb85;
    }
    th, td {
        padding: 5px;
        text-align: center;
    }
    
    .reserved {
        color: white;
    }
    .available {
        color: white;
    }
    .status {
        font-size: 12px;
        display: block;
        margin-top: 5px;
    }
    .status span {
        font-weight: bold;
    }
</style>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>
<body>

	<header>
		<h1>日程選択</h1>
	</header>

	<main>
		<h2 id="calendar-heading">カレンダー</h2>

		<div id="calendar-buttons">
		    <button class="btn btn-outline-dark" onclick="previousMonth()">＜</button>
		    <button class="btn btn-outline-dark" onclick="nextMonth()">＞</button>
		</div>
		<div id="calendar-container">
		    <table id="calendar-table">
		        <thead>
		            <tr id="calendar-header"></tr>
		        </thead>
		        <form id="form" action="/selectTime" method="post">
					<input type="hidden" name="confirmDate" id="confirmDate">
					<tbody id="calendar-body"></tbody>
		        </form>
		    </table>
		</div>
		
	</main>
	
	<script>
	    var currentYear, currentMonth;
	    var headerRow = document.getElementById('calendar-header');
	    var body = document.getElementById('calendar-body');
	
	    // 初期表示は今月のカレンダー
	    var today = new Date();
	    currentYear = today.getFullYear();
	    currentMonth = today.getMonth();
	
	    // 予約情報のサンプルデータ (日付をキーとした予約状態の配列)
	    var reservations = {
	        '2024-07-05': true,   // 2024年7月5日が予約済み
	        '2024-07-15': false,  // 2024年7月15日が空いている
	        '2024-07-20': true    // 2024年7月20日が予約済み
	    };
	
	    // カレンダーを表示する関数
	    function showCalendar(year, month) {
	        // ヘッダーの曜日を設定
	        var days = ['日', '月', '火', '水', '木', '金', '土'];
	        headerRow.innerHTML = '';
	        days.forEach(function(day) {
	            var th = document.createElement('th');
	            th.textContent = day;
	            headerRow.appendChild(th);
	        });
	
	        // カレンダーのボディを生成
	        body.innerHTML = '';
	        var startDate = new Date(year, month, 1);
	        var endDate = new Date(year, month + 1, 0);
	        var currentRow = document.createElement('tr');
	        for (var i = 0; i < startDate.getDay(); i++) {
	            currentRow.appendChild(document.createElement('td'));
	        }
	        for (var i = startDate.getDate(); i <= endDate.getDate(); i++) {
	            var dateKey = year + '-' + (month + 1 < 10 ? '0' + (month + 1) : month + 1) + '-' + (i < 10 ? '0' + i : i);
	            var reservationStatus = reservations[dateKey];
	
	            var dayCell = document.createElement('td');
	
	            // 日付をテキストとして表示
	            var dateText = document.createElement('span');
	            dateText.textContent = i;
	            dayCell.appendChild(dateText);

	            // 予約状態に応じて背景色を設定
	            if (reservationStatus === true) {
	                dayCell.classList.add('reserved');
	            } else {
	                dayCell.classList.add('available');
	            }
	            
	            // ○×を表示する要素を追加
				var statusText = document.createElement('span');
                statusText.setAttribute('data-datekey', dateKey);
				statusText.classList.add('status');
				if (reservationStatus === true) {
				    statusText.innerHTML = '<button disabled class="btn btn-outline-light btn-sm" style="color: red;">Ｘ</button>';
				} else {
				    statusText.innerHTML = '<input type="button" id="decidedDate" name="decidedDate" class="btn btn-outline-light btn-sm" style="color: green;" value="〇">';
				    
				}
                dayCell.appendChild(statusText);

	            // ボタンがクリックされたときの処理
	            statusText.addEventListener('click', function() {
                    // 日付のdateKeyを保存する属性を追加
                    var selectedDate = this.getAttribute('data-datekey');
				    document.getElementById('confirmDate').setAttribute('value', selectedDate);
	                var chooseDate = document.getElementById('decidedDate').value;
	               	const form = document.getElementById('form');
	               	form.submit();
	                // ここに他の処理を追加する（例: 予約処理など）
	            });

	            currentRow.appendChild(dayCell);

	            if (currentRow.children.length % 7 == 0) {
	                body.appendChild(currentRow);
	                currentRow = document.createElement('tr');
	            }
	        }
	        if (currentRow.children.length > 0) {
	            body.appendChild(currentRow);
	        }
	
	        // カレンダーのタイトルを設定
	        document.getElementById('calendar-heading').textContent = year + '年' + (month + 1) + '月';
	    }
	
	    // 初回表示
	    showCalendar(currentYear, currentMonth);
	
	    // 前の月へ移動する関数
	    function previousMonth() {
			if (currentYear === today.getFullYear() && currentMonth === today.getMonth()) return; // 前の月には遷移不可
	        currentMonth--;
	        if (currentMonth < 0) {
	            currentMonth = 11;
	            currentYear--;
	        }
	        showCalendar(currentYear, currentMonth);
	    }
	
	    // 次の月へ移動する関数
	    function nextMonth() {
			var maxDate = new Date(today.getFullYear(), today.getMonth() + 3, 0); // 先２カ月まで遷移可能
			if(new Date(currentYear, currentMonth + 1) > maxDate) return;
	        currentMonth++;
	        if (currentMonth > 11) {
	            currentMonth = 0;
	            currentYear++;
	        }
	        showCalendar(currentYear, currentMonth);
	    }
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
	
</body>
</html>